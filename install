#!/bin/bash
export PATH=/usr/local/bin:${PATH}

export CONF_BASE=~/.config
export RUST_SRC_PATH=~/.multirust/toolchains/stable-x86_64-apple-darwin/lib/rustlib/src/rust/src


brew_install()
{
  # brew install
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  #
  brew tap caskroom/cask

  caskapp=(
   google-chrome
   android-file-transfer
   1password
   buttercup
   dropbox
   skype
   steam
   cooviewer
   vlc
   iterm2
   dash
   android-studio
   virtualbox
   vagrant
   java
   docker
   utorrent
  )
  brew cask install ${caskapp[@]}

  cellers=(
   wget
   coreutils
   findutils
   luajit
   lua
   git
   mercurial
   zsh
   z
   tmux
   the_silver_searcher
   reattach-to-user-namespace
   python
   rbenv
   go
   neovim/neovim/neovim
  )

  brew install ${cellers[@]}

  brew cleanup
}

# pip_install
pip_install()
{
  pip3 install --upgrade pip setuptools wheel
  pip install --upgrade pip setuptools wheel
}

# ruby
ruby_install()
{
  rbenv install 2.5.1
  rbenv global 2.5.1
}

gem_install()
{
  gem install neovim
}

# rust
rust_install()
{
  curl https://sh.rustup.rs -sSf | sh
  source $HOME/.cargo/env
  cargo install racer
  cargo install rustfmt
  rustup component add rust-src
}

go_install()
{
  # install go
  #OS_TYPE=linux-386
  OS_TYPE=linux-amd64
  GO_VERSION=1.7.4
  ZIPNAME=go${GO_VERSION}.${OS_TYPE}.tar.gz
  set +eu
  CHECK_VERSION=$(go version|grep ${GO_VERSION})
  set -eu
  if [ -z "${CHECK_VERSION}" ]; then
    wget http://golang.org/dl/${ZIPNAME}
    sudo tar zxvf ${ZIPNAME} -C /usr/local
    rm ${ZIPNAME}
  fi

  PATH=/usr/local/go/bin/:$PATH
  export PATH
}




if [ -n $CONF_BASE ]; then
  mkdir -p $CONF_BASE
fi

if [ "$(uname)" == 'Darwin' ]; then
  OS='Mac'
  brew_install
elif [ "$(expr substr $(uname -s) 1 5)" == 'Linux' ]; then
  OS='Linux'
  go_install
elif [ "$(expr substr $(uname -s) 1 10)" == 'MINGW32_NT' ]; then
  OS='Cygwin'
else
  echo "Your platform ($(uname -a)) is not supported."
  exit 1
fi

pip_install
ruby_install
gem_install



# repos
repos=(\
 dotfiles\
 new_dotfiles\
 zshrc\
 zsh-utils\
 init.vim\
 tmux.conf\
)

own_repos_dir=~/repos/github.com/bundai223/
mkdir -p $own_repos_dir
cd $own_repos_dir

github_base_url=https://github.com

for repo in ${repos[@]}; do
  if [ ! -e ${repo} ]; then
    git clone ${github_base_url}/bundai223/${repo}
  fi
done
# nvim

# Create symbolic link to dotfiles
DOTFILES_ENTITY_PATH=~/repos/github.com/bundai223/new_dotfiles
DOTFILE_NAMES_ARRAY=\
(\
 .gitconfig\
 .config/git/.gitignore_global\
 .config/git/.gitattributes_global\
 .config/git/templates\
 .ctags\
)

for dotfile in ${DOTFILE_NAMES_ARRAY[@]}; do
  if [ ! -e ~/${dotfile} ]; then
    ln -s ${DOTFILES_ENTITY_PATH}/${dotfile} ~/${dotfile}
  fi
done

# Make git configuration file that include common config to make local setting.
if [ ! -e ~/.config/git/.gitconfig_local ]; then
    cp ${DOTFILES_ENTITY_PATH}/.config/git/.gitconfig_local ~/.config/git/.gitconfig_local
fi

wget https://github.com/itamae-kitchen/mitamae/releases/download/v1.5.6/mitamae-x86_64-darwin -O bin/mitamae
